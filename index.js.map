{"version":3,"sources":["webpack:///webpack/bootstrap 688d92f7064a4487c457","webpack:///./source/Frame.js","webpack:///./source/Client.js","webpack:///external \"event-dispatcher\"","webpack:///./source/Message.js","webpack:///./source/index.js","webpack:///./source/BufferIterator.js","webpack:///./source/IncomingStream.js","webpack:///./source/IncomingMessage.js","webpack:///./source/WebSocketServer.js","webpack:///external \"http\"","webpack:///external \"crypto\""],"names":["CONTINUATION_TYPE","TEXT_TYPE","BINARY_TYPE","CLOSE_TYPE","PING_TYPE","PONG_TYPE","mask","frameBuffer","position","maskData","Buffer","allocUnsafe","writeUInt32BE","Math","random","pow","copy","setDataLength","dataLength","shift","writeDoubleBE","writeUInt16BE","create","data","masked","index","length","buffer","entry","byte","readMask","parse","startPosition","result","readUInt16BE","readDoubleBE","Error","slice","parseStream","list","push","concat","readFrameLength","size","readPayloadLength","getType","isFinal","Boolean","bounds","type","last","splitData","frameSize","iterator","Frame","clients","Map","SOCKET_KEY","Symbol","Client","constructor","socket","_dataHandler","frameLength","frame","_addFrameToIncomingStream","_incoming","hasEventListener","MESSAGE_RECEIVED","append","dispatchEvent","createMessage","end","send","valueOf","_errorHandler","error","ERROR","_endHandler","END","_closeHandler","delete","CLOSE","on","count","message","write","MESSAGE_SENT","client","set","get","values","BUFFER_KEY","MessageIterator","_list","_length","_index","next","currentIndex","value","undefined","done","Message","maskedDefault","frameSizeDefault","createBuffer","hasOwnProperty","JSON","stringify","isNaN","wsServer","init","requestOrServer","head","Object","assign","CLIENT_CONNECTED","CLIENT_DISCONNECTED","addEventListener","handler","removeEventListener","removeAllEventListeners","WebSocketServer","BufferIterator","_buffer","_current","_pieces","ceil","_frameSize","current","pos","IncomingStream","IncomingMessage","stream","rawData","toString","UUID","SUPPORTED_VERSIONS","createKeyResponse","key","createHash","update","digest","_upgradeHandler","request","_acceptConnection","_clientCloseHandler","event","response","upgrade","headers","version","toLowerCase","Server"],"mappings":"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","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 688d92f7064a4487c457","/**\n * Created by Oleg Galaburda on 07.04.16.\n */\n\n'use strict';\n\nimport BufferIterator from './BufferIterator';\n\nexport const CONTINUATION_TYPE = 0x0;\nexport const TEXT_TYPE = 0x1;\nexport const BINARY_TYPE = 0x2;\nexport const CLOSE_TYPE = 0x8;\nexport const PING_TYPE = 0x9;\nexport const PONG_TYPE = 0xA;\n\nexport const mask = (frameBuffer, position) => {\n  const maskData = Buffer.allocUnsafe(4);\n  //FIXME standard random algorithm is not reliable, please update if looking for further work with this project\n  maskData.writeUInt32BE(Math.random() * Math.pow(2, 32) >>> 0);\n  maskData.copy(frameBuffer, position, 0, 4);\n  return maskData;\n};\n\nexport const setDataLength = (frameBuffer, dataLength) => {\n  const position = 2;\n  let shift = 0;\n  if (dataLength > 65535) {\n    frameBuffer[1] = frameBuffer[1] | 127;\n    frameBuffer.writeDoubleBE(dataLength, position);\n    shift = 8;\n  } else if (dataLength > 125) {\n    frameBuffer[1] = frameBuffer[1] | 126;\n    frameBuffer.writeUInt16BE(dataLength, position);\n    shift = 2;\n  } else {\n    frameBuffer[1] = frameBuffer[1] | dataLength;\n  }\n  return shift;\n};\n\nexport const create = (data, masked) => {\n  let maskData;\n  let index;\n  let position = 2;\n  const dataLength = data.length;\n  const buffer = Buffer.allocUnsafe(length(dataLength, masked));\n  buffer[0] = 0; // FIN + RSV1-3 + OPCODE\n  buffer[1] = (masked ? 1 : 0) << 7;\n  position += setDataLength(buffer, dataLength);\n  /* Messages from server should not be masked\n   https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_servers\n   */\n  if (masked) {\n    maskData = mask(buffer, position);\n    position += 4;\n    index = 0;\n    for (let entry of data) {\n      let byte = entry[1];\n      buffer[position++] = byte ^ maskData[index++ % 4];\n    }\n  } else {\n    data.copy(buffer, position, 0, data.length);\n  }\n  return buffer;\n};\n\nexport const readMask = (frameBuffer, position) => {\n  const maskData = Buffer.allocUnsafe(4);\n  frameBuffer.copy(maskData, 0, position, position + 4);\n  return maskData;\n};\n\n/**\n *\n * @param {Buffer} data\n * @param {Number} [startPosition=0]\n * @returns {?Buffer}\n */\nexport const parse = (data, startPosition) => {\n  startPosition = startPosition || 0;\n  if (!data || !data.length) return null;\n  let result;\n  const masked = data[startPosition + 1] >>> 7;\n  let length = data[startPosition + 1] & Math.pow(2, 7) - 1;\n  let position = startPosition + 2;\n  if (length > 125) {\n    if (length == 126) {\n      length = data.readUInt16BE(position);\n      position += 2;\n    } else {\n      length = data.readDoubleBE(position);\n      position += 8;\n    }\n  }\n  if (position + (masked && 4) + length < data.length) {\n    throw new Error('Cannot parse incomplete or broken? frame package.');\n  }\n  if (masked) {\n    result = Buffer.allocUnsafe(length);\n    const mask = readMask(data, position);\n    position += 4;\n    for (let index = 0; index < length; index++, position++) {\n      result[index] = data[position] ^ mask[index % 4];\n    }\n  } else {\n    result = data.slice(position, length);\n  }\n  return result;\n};\n\n/**\n * @param {Buffer[]} list\n */\nexport const parseStream = (list) => {\n  const result = [];\n  const length = list.length;\n  for (let index = 0; index < length; index++) {\n    result.push(parse(list[index]));\n  }\n  return Buffer.concat(result);\n};\n\n/**\n *\n * @param {Buffer} data\n * @param {Number} [startPosition=0]\n * @returns {Number}\n */\nexport const readFrameLength = (data, startPosition) => {\n  startPosition = startPosition || 0;\n  if (!data || data.length <= startPosition) return 0;\n  const position = startPosition + 2;\n  let size = 2 + ((data[startPosition + 1] >>> 7) && 4);\n  let length = data[startPosition + 1] & Math.pow(2, 7) - 1;\n  if (length > 125) {\n    if (length == 126) {\n      length = data.readUInt16BE(position);\n      size += 2;\n    } else {\n      length = data.readDoubleBE(position);\n      size += 8;\n    }\n  }\n  return size + length;\n};\n\n/**\n *\n * @param {Buffer} data\n * @param {Number} [startPosition=0]\n * @returns {Number}\n */\nexport const readPayloadLength = (data, startPosition) => {\n  startPosition = startPosition || 0;\n  if (!data || data.length <= startPosition + 2) return 0;\n  let length = data[startPosition + 1] & Math.pow(2, 7) - 1;\n  const position = startPosition + 2;\n  if (length > 125) {\n    if (length == 126) {\n      length = data.readUInt16BE(position);\n    } else {\n      length = data.readDoubleBE(position);\n    }\n  }\n  return length;\n};\n\nexport const length = (dataLength, masked) => {\n  let length = 2;\n  if (masked) {\n    length += 4;\n  }\n  if (dataLength > 65535) {\n    length += 8;\n  } else if (dataLength > 125) {\n    length += 2;\n  }\n  return length + dataLength;\n};\n\nexport const getType = (buffer) => (buffer[0] & (Math.pow(2, 4) - 1));\n\nexport const isFinal = (buffer) => Boolean(buffer[0] >>> 7);\n\nexport const bounds = (list, type) => {\n  const last = list.length - 1;\n  // init first frame, set type opcode\n  list[0][0] = list[0][0] >>> 4 << 4 | type;\n  // init last frame, set FIN\n  list[last][0] = list[last][0] | 1 << 7;\n};\n\nexport const splitData = (data, frameSize, masked) => {\n  const list = [];\n  const iterator = new BufferIterator(data, frameSize);\n  for (let buffer of iterator) {\n    list.push(create(buffer, Boolean(masked)));\n  }\n  return list;\n};\n\n\n\n// WEBPACK FOOTER //\n// ./source/Frame.js","/**\n * Created by Oleg Galaburda on 07.04.16.\n */\n\n'use strict';\n\nimport EventDispatcher from 'event-dispatcher';\nimport * as Frame from './Frame';\nimport Message from './Message';\nimport IncomingStream from './IncomingStream';\n\nconst clients = new Map();\nconst SOCKET_KEY = Symbol('client::socket');\n/**\n * @param {net.Socket } socket\n * @constructor\n */\nclass Client extends EventDispatcher {\n  constructor(socket) {\n    super();\n    /**\n     * @type {net.Socket}\n     */\n    this[SOCKET_KEY] = socket;\n    /**\n     * @type {?IncomingMessage}\n     * @private\n     */\n    this._incoming = null;\n\n    //TODO handle incoming messages\n    socket.on('data', this._dataHandler);\n    socket.on('error', this._errorHandler);\n    socket.on('end', this._endHandler);\n    socket.on('close', this._closeHandler);\n  }\n\n  /**\n   * @member {Number} Client.count\n   */\n  get count() {\n    return clients.size;\n  }\n\n  /**\n   * @private\n   */\n  _dataHandler = (data) => {\n    let position = 0;\n    do {\n      const frameLength = Frame.readFrameLength(data, position);\n      if (!frameLength) break;\n      const frame = Buffer.allocUnsafe(frameLength);\n      data.copy(frame, 0, position, position + frameLength);\n      this._addFrameToIncomingStream(frame);\n      position += frameLength;\n    } while (position < data.length && frameLength);\n  };\n\n  /**\n   * @param frame\n   * @private\n   */\n  _addFrameToIncomingStream = (frame) => {\n    if (!this._incoming) {\n      // don't bother looking for data if developer not interested in it\n      if (!this.hasEventListener(Client.MESSAGE_RECEIVED)) return;\n      this._incoming = new IncomingStream();\n    }\n    //FIXME client may send multiple frames in one data chunk, data receiver should check this\n    this._incoming.append(frame);\n    if (this._incoming.isFinal()) {\n      switch (this._incoming.getType()) {\n        case Frame.BINARY_TYPE:\n        case Frame.TEXT_TYPE:\n          this.dispatchEvent(Client.MESSAGE_RECEIVED, this._incoming.createMessage());\n          break;\n        case Frame.CLOSE_TYPE:\n          this[SOCKET_KEY].end();\n          break;\n        case Frame.PING_TYPE:\n          this.send(Message.create(this._incoming.valueOf(), Frame.PONG_TYPE));\n          break;\n      }\n      this._incoming = null;\n    }\n  };\n\n  /**\n   * @private\n   */\n  _errorHandler = (error) => {\n    if (this.hasEventListener(Client.ERROR)) {\n      this.dispatchEvent(Client.ERROR, error);\n    }\n  };\n\n  /**\n   * @private\n   */\n  _endHandler = () => {\n    if (this.hasEventListener(Client.END)) {\n      this.dispatchEvent(Client.END, this);\n    }\n  };\n\n  /**\n   * @private\n   */\n  _closeHandler = () => {\n    clients.delete(this[SOCKET_KEY]);\n    if (this.hasEventListener(Client.CLOSE)) {\n      this.dispatchEvent(Client.CLOSE, this);\n    }\n  };\n\n  send(message) {\n    if (message) {\n      if (!(message instanceof Message)) {\n        message = Message.create(message);\n      }\n    } else {\n      throw new Error('Message cannot be empty.');\n    }\n    /**\n     * @var {net.Socket}\n     */\n    const socket = this[SOCKET_KEY];\n    for (let frame of message) {\n      socket.write(frame);\n    }\n    if (this.hasEventListener(Client.MESSAGE_SENT)) {\n      this.dispatchEvent(Client.MESSAGE_SENT);\n    }\n  }\n\n  /**\n   * @method Client.create\n   * @param {net.Socket} socket\n   * @returns {Client}\n   */\n  static create(socket) {\n    const client = new Client(socket);\n    clients.set(socket, client);\n    return client;\n  }\n\n  /**\n   * @method Client.get\n   * @param {net.Socket} socket\n   * @returns {Client}\n   */\n  static get(socket) {\n    let client = clients.get(socket);\n    if (!client) {\n      client = Client.create(socket);\n    }\n    return client;\n  }\n\n  static CLOSE = 'close';\n  static END = 'end';\n  static ERROR = 'error';\n  static MESSAGE_RECEIVED = 'messageReceived';\n  static MESSAGE_SENT = 'messageSent';\n}\n\n/**\n * @returns {Iterator.<Client>}\n * @private\n */\nClient[Symbol.iterator] = () => clients.values();\n\nexport default Client;\n\n\n// WEBPACK FOOTER //\n// ./source/Client.js","module.exports = require(\"event-dispatcher\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"event-dispatcher\"\n// module id = 2\n// module chunks = 0","/**\n * Created by Oleg Galaburda on 07.04.16.\n */\n\n'use strict';\n\nimport * as Frame from './Frame';\n\nconst BUFFER_KEY = Symbol('message::buffer');\n\n/**\n * it will get all packages of valueOf and iterate through them\n *\n */\nexport class MessageIterator {\n  constructor(message) {\n    this._list = message.valueOf();\n    this._length = this._list.length;\n    this._index = 0;\n  }\n\n  next() {\n    const currentIndex = this._index++;\n    let result;\n    if (currentIndex >= this._length) {\n      result = { value: undefined, done: true };\n    } else {\n      result = { value: this._list[currentIndex], done: false };\n    }\n    return result;\n  }\n}\n\n/**\n * @param {Buffer} data\n * @param {Number} type\n * @constructor\n */\nclass Message {\n  constructor(data, type) {\n    this[BUFFER_KEY] = data;\n    this.type = type;\n    this.masked = Message.maskedDefault;\n    this.frameSize = Message.frameSizeDefault;\n  }\n\n  valueOf() {\n    const list = Frame.splitData(this[BUFFER_KEY], this.frameSize, this.masked);\n    Frame.bounds(list, this.type);\n    return list;\n  }\n\n  [Symbol.iterator]() {\n    return new MessageIterator(this);\n  }\n\n  /**\n   * @param {*} data\n   * @returns {Buffer}\n   */\n  static createBuffer(data) {\n    if (data === null || data === undefined) {\n      return Buffer.allocUnsafe(0);\n    } else {\n      if (data instanceof Buffer) {\n        return data;\n      } else if (data.hasOwnProperty('buffer') && data.buffer instanceof Buffer) {\n        return data.buffer;\n      } else if (typeof(data) !== 'string') {\n        data = JSON.stringify(data);\n      }\n\n      const buffer = Buffer.allocUnsafe(data.length);\n      buffer.write(data);\n      return buffer;\n    }\n  }\n\n  /**\n   * @param {*} data\n   * @returns {number}\n   * @constructor\n   */\n  static getType(data) {\n    if (data === null || data === undefined || data instanceof Buffer || (data.hasOwnProperty('buffer') && data.buffer instanceof Buffer)) {\n      return Frame.BINARY_TYPE;\n    }\n    return Frame.TEXT_TYPE;\n  }\n\n  /**\n   * @param {*} data\n   * @param {Number} [type]\n   * @returns {Message}\n   */\n  static create(data, type) {\n    if (isNaN(type)) {\n      type = Message.getType(data);\n    }\n    return new Message(Message.createBuffer(data), type);\n  }\n\n  static maskedDefault = false;\n  static frameSizeDefault = 0;\n}\n\nexport default Message;\n\n\n\n// WEBPACK FOOTER //\n// ./source/Message.js","import Client from './Client';\r\nimport * as Frame from './Frame';\r\nimport Message from './Message';\r\nimport WebSocketServer, { CLIENT_CONNECTED, CLIENT_DISCONNECTED } from './WebSocketServer';\r\n\r\nconst wsServer = new WebSocketServer();\r\n\r\n/*\r\n * @param {http.Server|http.ClientRequest} requestOrServer\r\n * @param {net.Socket} [socket=null]\r\n * @param {Object} [head=null]\r\n */\r\nconst init = (requestOrServer, socket = null, head = null) => {\r\n  wsServer.init(requestOrServer, socket, head);\r\n};\r\n\r\nObject.assign(init, {\r\n  Client,\r\n  Message,\r\n  Frame,\r\n  CLIENT_CONNECTED,\r\n  CLIENT_DISCONNECTED,\r\n  addEventListener: (type, handler) => wsServer.addEventListener(type, handler),\r\n  hasEventListener: (type) => wsServer.hasEventListener(type),\r\n  removeEventListener: (type, handler) => wsServer.removeEventListener(type, handler),\r\n  removeAllEventListeners: (type) => wsServer.removeAllEventListeners(type),\r\n});\r\n\r\nexport { Client, Message, Frame, WebSocketServer };\r\nexport default init;\r\n\n\n\n// WEBPACK FOOTER //\n// ./source/index.js","/**\n * Created by Oleg Galaburda on 07.04.16.\n */\n\n'use strict';\n\nclass BufferIterator {\n  constructor(buffer, frameSize) {\n    this._buffer = buffer;\n    this._length = buffer.length;\n    this._current = 0;\n    this._pieces = frameSize > 0 ? Math.ceil(this._length / frameSize) : 1;\n    this._frameSize = frameSize;\n  }\n\n  next() {\n    const current = this._current++;\n    if (current >= this._pieces) {\n      return {\n        value: undefined,\n        done: true,\n      };\n    } else if (current === 0 && this._pieces === 1) {\n      // special case when buffer should be sent in one frame, covers most communication sets :)\n      return {\n        value: this._buffer,\n        done: false,\n      };\n    }\n\n    let size = this._frameSize;\n    const pos = current * this._frameSize;\n    if (this._current * this._frameSize > this._length) {\n      size = this._length - pos;\n    }\n    return {\n      value: this._buffer.slice(pos, pos + size),\n      done: false,\n    };\n  }\n\n  [Symbol.iterator] = () => this;\n}\n\nexport default BufferIterator;\n\n\n\n// WEBPACK FOOTER //\n// ./source/BufferIterator.js","/**\n * Created by Oleg Galaburda on 07.04.16.\n */\n\n'use strict';\n\nimport * as Frame from './Frame';\nimport IncomingMessage from './IncomingMessage';\n\nclass IncomingStream {\n  constructor() {\n    this._list = [];\n  }\n\n  append(buffer) {\n    this._list.push(buffer);\n  }\n\n  valueOf() {\n    return Frame.parseStream(this._list);\n  }\n\n  createMessage() {\n    return this.isFinal() ? new IncomingMessage(this) : null;\n  }\n\n  getType() {\n    return this._list.length ? Frame.getType(this._list[0]) : 0;\n  }\n\n  isFinal() {\n    return Boolean(this._list.length && Frame.isFinal(this._list[0]));\n  }\n}\n\nexport default IncomingStream;\n\n\n// WEBPACK FOOTER //\n// ./source/IncomingStream.js","/**\n * Created by Oleg Galaburda on 07.04.16.\n */\n\n'use strict';\n\nimport * as Frame from './Frame';\n\nclass IncomingMessage {\n  constructor (stream) {\n    this.stream = stream;\n    this.rawData = stream.valueOf();\n    this.type = stream.getType();\n    this.value = this.type === Frame.TEXT_TYPE ? this.rawData.toString() : this.rawData;\n  }\n}\n\nexport default IncomingMessage;\n\n\n// WEBPACK FOOTER //\n// ./source/IncomingMessage.js","/**\n * Created by Oleg Galaburda on 07.04.16.\n */\n\n'use strict';\n\nimport http from 'http';\nimport crypto from 'crypto';\nimport EventDispatcher from 'event-dispatcher';\nimport Client from './Client';\n\nconst UUID = '258EAFA5-E914-47DA-95CA-C5AB0DC85B11';\n\nconst SUPPORTED_VERSIONS = {\n  '13': true,\n};\n\nconst createKeyResponse = (key) => crypto.createHash('SHA1').update(key + UUID).digest('base64');\n\nexport const CLIENT_CONNECTED = 'clientConnected';\nexport const CLIENT_DISCONNECTED = 'clientDisconnected';\n\n/**\n * @var {WSSHandler|EventDispatcher} WebSocketServer\n */\nclass WebSocketServer extends EventDispatcher {\n\n  init(requestOrServer, socket = null, head = null) {\n    if (requestOrServer instanceof http.Server) {\n      requestOrServer.on('upgrade', this._upgradeHandler);\n    } else {\n      this._upgradeHandler(requestOrServer, socket, head);\n    }\n  };\n\n  /**\n   * @param {http.ClientRequest} request\n   * @param {net.Socket} [socket=null]\n   * @param {Object} [head=null]\n   */\n  _upgradeHandler = (request, socket, head) => {\n    if (this._acceptConnection(request, socket)) {\n      const client = Client.get(socket);\n      client.addEventListener(Client.CLOSE, this._clientCloseHandler);\n      if (this.hasEventListener(CLIENT_CONNECTED)) {\n        this.dispatchEvent(CLIENT_CONNECTED, client);\n      }\n    }\n  };\n\n  _clientCloseHandler = (event) => {\n    const client = event.data;\n    client.removeEventListener(Client.CLOSE, this._clientCloseHandler);\n    if (this.hasEventListener(CLIENT_DISCONNECTED)) {\n      this.dispatchEvent(CLIENT_DISCONNECTED, client);\n    }\n  };\n\n  _acceptConnection = (request, socket) => {\n    let response;\n    let result = false;\n    const upgrade = request.headers['upgrade'];\n    const key = request.headers['sec-websocket-key'];\n    const version = request.headers['sec-websocket-version'];\n    if (upgrade && upgrade.toLowerCase() === 'websocket' && version && SUPPORTED_VERSIONS[version]) {\n      response = 'HTTP/1.1 101 Web Socket Protocol Handshake' + '\\r\\n' +\n        'Upgrade: websocket' + '\\r\\n' +\n        'Connection: Upgrade' + '\\r\\n' +\n        'Sec-WebSocket-Accept: ' + createKeyResponse(key) + '\\r\\n' +\n        // skip message compression for now\n        //'Sec-WebSocket-Extensions: permessage-deflate' + '\\r\\n' +\n        '\\r\\n';\n      result = true;\n    } else {\n      response = 'HTTP/1.1 400 Bad Request' + '\\r\\n' +\n        '\\r\\n';\n    }\n    socket.write(response);\n    return result;\n  }\n}\n\nexport default WebSocketServer;\n\n\n\n// WEBPACK FOOTER //\n// ./source/WebSocketServer.js","module.exports = require(\"http\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"http\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"crypto\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"crypto\"\n// module id = 10\n// module chunks = 0"],"sourceRoot":""}